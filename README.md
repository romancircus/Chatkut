# ChatKut - AI-Powered Video Editor

An open-source chat-based video editor powered by Remotion, Dedalus SDK, and Plan-Execute-Patch architecture.

**Built this because I hate video editing and hiring editors are too expensive. I wanted a cost efficient way to mass produce media programmatically & conversationally.**

---

## âœ¨ Features

- ğŸ¤– **AI-Powered Editing** - Natural language video editing with GPT-4o
- ğŸ¬ **Remotion Integration** - Professional video rendering with React
- âš¡ **Real-time Preview** - See your edits instantly with live composition preview
- ğŸ“¤ **Resumable Uploads** - TUS protocol for reliable large file uploads
- ğŸ”„ **Undo/Redo** - Full history with keyboard shortcuts (Cmd+Z)
- â˜ï¸ **Cloud Rendering** - Remotion Lambda for fast, scalable video exports
- ğŸ’° **Cost Tracking** - Transparent rendering costs with estimates
- ğŸ¨ **Modern UI** - Dark theme inspired by Remotion's design language
- ğŸ”¥ **Real-time Sync** - Changes propagate instantly via Convex
- ğŸ¯ **Smart Selectors** - AI understands "the second clip" with disambiguation

---

## Quick Start

### 1. Install Dependencies

```bash
npm install
```

### 2. Set Up Convex

```bash
npx convex dev
```

### 3. Configure Environment Variables

Copy `.env.example` to `.env.local` and add your credentials:

```bash
cp .env.example .env.local
```

Required environment variables:
- `CLOUDFLARE_ACCOUNT_ID`
- `CLOUDFLARE_STREAM_TOKEN`
- `CLOUDFLARE_R2_ACCESS_KEY`
- `CLOUDFLARE_R2_SECRET_KEY`
- `DEDALUS_API_KEY`
- `NEXT_PUBLIC_CONVEX_URL` (generated by `npx convex dev`)

### 4. Run Development Server

```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) to see the app.

## Project Structure

```
chatkut/
â”œâ”€â”€ app/                    # Next.js 14 app router
â”‚   â”œâ”€â”€ (auth)/            # Auth pages (login, signup)
â”‚   â”œâ”€â”€ (dashboard)/       # Main app pages
â”‚   â””â”€â”€ api/               # API routes (webhooks)
â”œâ”€â”€ components/            # React components
â”‚   â”œâ”€â”€ chat/             # Chat interface components
â”‚   â”œâ”€â”€ editor/           # Video editor UI
â”‚   â”œâ”€â”€ player/           # HLS + Remotion players
â”‚   â””â”€â”€ upload/           # TUS upload widget
â”œâ”€â”€ convex/               # Convex backend
â”‚   â”œâ”€â”€ schema.ts         # Database schema
â”‚   â”œâ”€â”€ compositions.ts   # Composition CRUD
â”‚   â”œâ”€â”€ media.ts          # Cloudflare integration
â”‚   â”œâ”€â”€ mcpProxy.ts       # MCP backend proxy
â”‚   â””â”€â”€ rendering.ts      # Remotion Lambda
â”œâ”€â”€ lib/                  # Shared utilities
â”‚   â”œâ”€â”€ composition-engine/
â”‚   â”‚   â”œâ”€â”€ planner.ts    # Edit plan generation
â”‚   â”‚   â”œâ”€â”€ executor.ts   # AST patching
â”‚   â”‚   â””â”€â”€ selectors.ts  # Selector resolution
â”‚   â””â”€â”€ dedalus/          # Dedalus SDK wrappers
â”œâ”€â”€ types/                # TypeScript types
â”‚   â””â”€â”€ composition-ir.ts # IR type definitions
â””â”€â”€ remotion/             # Remotion compositions
    â””â”€â”€ templates/        # Starter templates
```

## Development

### Commands

```bash
# Development
npm run dev              # Start Next.js dev server
npx convex dev          # Start Convex backend

# Testing
npm test                # Run all tests
npm run type-check      # TypeScript type checking
npm run lint            # ESLint

# Deployment
npx convex deploy       # Deploy Convex backend
vercel deploy --prod    # Deploy Next.js frontend
npx remotion lambda deploy  # Deploy Remotion Lambda
```

## Architecture

ChatKut uses a **Plan-Execute-Patch** architecture instead of full code regeneration:

1. **Plan Generation**: LLM generates structured Edit Plans (IR)
2. **Selector Resolution**: Validate and resolve element selectors
3. **AST Patching**: Apply changes via Babel AST manipulation
4. **Persistence**: Save patches for undo/redo
5. **Feedback**: Show user-friendly receipts

See `CLAUDE.md` for detailed architecture documentation.

## Implementation Progress

### âœ… Completed: Weeks 1-6

**Week 1-2: Foundation**
- âœ… Next.js 14 + TypeScript + Tailwind
- âœ… Convex backend
- âœ… Cloudflare Stream + R2 integration
- âœ… Dedalus AI integration (GPT-4o)

**Week 3: Frontend UI**
- âœ… Design system (Remotion-inspired dark theme)
- âœ… Homepage with project listing
- âœ… Chat interface with real-time sync
- âœ… TUS upload widget
- âœ… HLS video player
- âœ… Asset library with filters
- âœ… 3-panel project dashboard

**Week 4: AI Integration**
- âœ… Chat message handling
- âœ… Edit plan generation
- âœ… Remotion code generation
- âœ… Context building for AI
- âœ… Token usage tracking

**Week 5: Composition Engine**
- âœ… Selector system (byId, byLabel, byIndex, byType)
- âœ… Executor engine (add, update, delete, move)
- âœ… Disambiguator UI
- âœ… Composition management

**Week 6: Advanced Features**
- âœ… Undo/redo with keyboard shortcuts
- âœ… History panel
- âœ… Remotion Player integration
- âœ… Remotion Lambda setup
- âœ… Render panel with progress tracking

See `IMPLEMENTATION_SUMMARY.md` for complete details.

## ğŸ“¸ Demo

### Chat-Based Editing
```
You: "Add my video and make it zoom in slowly"
AI: "I'll add your video with a scale animation..."
[Preview updates in real-time]
```

### Natural Commands
- "Make the second clip louder"
- "Add text saying 'Subscribe'"
- "Fade in the background music"
- "Move the logo to the top right"

### Undo Anything
Just press `Cmd+Z` - full history tracking with snapshots.

---

## ğŸ“š Documentation

- **[START_TESTING.md](START_TESTING.md)** - Quick start guide (3 steps to run locally)
- **[TESTING_GUIDE.md](TESTING_GUIDE.md)** - Comprehensive test scenarios
- **[IMPLEMENTATION_SUMMARY.md](IMPLEMENTATION_SUMMARY.md)** - Complete feature breakdown
- **[CLAUDE.md](CLAUDE.md)** - Architecture guidance for AI development
- **[IMPLEMENTATION_PLAN.md](IMPLEMENTATION_PLAN.md)** - Original 8-week roadmap

---

## ğŸ¤ Contributing

Contributions welcome! This project follows the implementation plan in `IMPLEMENTATION_PLAN.md`.

**Priority areas:**
- Authentication (Clerk/Auth0)
- Timeline UI for precise editing
- More AI models via Dedalus
- Template marketplace
- Export to social media formats

---

## ğŸ“„ License

MIT - Open Source

**Free to use commercially.** Built with love for creators who hate traditional video editing.

---

## ğŸ™ Acknowledgments

Built with:
- [Remotion](https://remotion.dev) - Video rendering in React
- [Convex](https://convex.dev) - Real-time backend
- [Dedalus](https://dedaluslabs.ai) - Multi-model AI routing
- [Cloudflare](https://cloudflare.com) - Stream & R2 storage
- [Next.js](https://nextjs.org) - React framework
- [Tailwind CSS](https://tailwindcss.com) - Styling

---

## â­ Star This Repo

If this saves you time (and money) on video editing, give it a star! â­
